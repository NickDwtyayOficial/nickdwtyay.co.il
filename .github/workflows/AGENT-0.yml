name: AGENT-0 - Melhorador Automático

on:
  schedule:
    - cron: '0 0 * * *'  # todo dia à meia-noite
  workflow_dispatch:    # tu consegue rodar quando quiser

jobs:
  improve-site:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          submodules: false

      - name: Chama a IA
        env:
          GROK_API_KEY: ${{ secrets.GROK_API_KEY }}
        run: |
          RESPONSE=$(curl -s -X POST https://api.x.ai/v1/chat/completions \
            -H "Authorization: Bearer $GROK_API_KEY" \
            -H "Content-Type: application/json" \
            -d '{
              "model": "grok-beta",
              "messages": [{"role": "user", "content": "Melhore o index.html pra carregar rápido, SEO e acessibilidade. Devolve só o HTML novo, nada de texto fora."} 0].message.content' > novo_index.html
          mv novo_index.html index.html
          git config user.name "Agent-0"
          git config user.email "agent@dwtyay.co.il"
          git add index.html
          git diff --cached --quiet || git commit -m "Atualização automática do index.html via IA"
          git push