- name: Chama Grok API (novo endpoint /v1/responses)
        env:
          GROK_API_KEY: ${{ secrets.GROK_API_KEY }}
        run: |
          echo "Tentando novo endpoint Responses API..."
          
          RESPONSE=$(curl -s -X POST https://api.x.ai/v1/responses \
            -H "Authorization: Bearer $GROK_API_KEY" \
            -H "Content-Type: application/json" \
            -d '{
              "model": "grok-4-latest",
              "messages": [
                {
                  "role": "user",
                  "content": "Analise api/index.php e melhore para performance, SEO, acessibilidade, segurança (CSRF, headers), privacidade. Retorne APENAS o código PHP/HTML/JS completo corrigido, sem texto extra."
                }
              ],
              "temperature": 0.3,
              "max_tokens": 8000
            }')
          
          # Parse diferente: /v1/responses usa formato próprio (não .choices[0])
          CONTENT=$(echo "$RESPONSE" | jq -r '.response // .text // empty')
          
          echo "Resposta completa:"
          echo "$RESPONSE"
          
          if [ -z "$CONTENT" ]; then
            echo "Resposta vazia ou erro no novo endpoint. Log: $RESPONSE"
            exit 0
          fi
          
          echo "$CONTENT" > novo_api_index.php
          mv novo_api_index.php api/index.php || echo "Falha mv"