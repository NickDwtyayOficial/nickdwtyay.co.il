name: ğŸ¤– Agent-0 Auto Update
on:
  workflow_dispatch:
    inputs:
      direct_push:
        description: 'ğŸš€ Push direto ao branch alvo? (true/false)'
        required: false
        default: 'false'
      target_branch:
        description: 'ğŸ¯ Branch destino (ex: main)'
        required: false
        default: 'main'

jobs:
  auto-commit:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: ğŸ”µ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.REPO_PAT }}
          fetch-depth: 0
      
      - name: ğŸŸ¢ Configure Git identity
        run: |
          git config user.name "Agent-0 Bot"
          git config user.email "agent-0-bot@users.noreply.github.com"
      
      - name: ğŸŸ¡ Check for changes
        id: check_changes
        run: |
          git add -A
          if git diff --cached --quiet; then
            echo "changes=false" >> $GITHUB_OUTPUT
            echo "â­ï¸ Nenhuma alteraÃ§Ã£o detectada"
            exit 0
          fi
          echo "changes=true" >> $GITHUB_OUTPUT
          echo "âœ… AlteraÃ§Ãµes detectadas!"
      
      - name: ğŸŸ£ Commit and Push
        if: steps.check_changes.outputs.changes == 'true'
        run: |
          TIMESTAMP=$(date -u '+%Y-%m-%d %H:%M:%S')
          COMMIT_MSG="ğŸ¤– Agent-0 update: ${TIMESTAMP}"
          git commit -m "${COMMIT_MSG}"
          
          if [ "${{ github.event.inputs.direct_push }}" == "true" ]; then
            echo "ğŸš€ PUSH DIRETO para ${{ github.event.inputs.target_branch }}"
            git push origin ${{ github.event.inputs.target_branch }}
          else
            BRANCH="agent-update-$(date -u +%Y%m%d%H%M%S)"
            echo "ğŸŒ¿ Criando branch: ${BRANCH}"
            git push origin HEAD:${BRANCH}
            
            echo "âœ… Branch criada! Agora crie um Pull Request manualmente:"
            echo "   https://github.com/NickDwtyayOficial/nickdwtyay.co.il/compare/${{ github.event.inputs.target_branch }}...${BRANCH}"
          fi
      
      - name: ğŸ”µ Success notification
        if: success()
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ‰ AGENT-0 EXECUTADO COM SUCESSO!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
