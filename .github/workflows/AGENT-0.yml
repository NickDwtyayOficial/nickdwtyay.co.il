- name: Chama Grok API (novo endpoint /v1/responses)
        env:
          GROK_API_KEY: ${{ secrets.GROK_API_KEY }}
        run: |
          echo "Usando o novo Responses API..."
          
          RESPONSE=$(curl -s -X POST https://api.x.ai/v1/responses \
            -H "Authorization: Bearer $GROK_API_KEY" \
            -H "Content-Type: application/json" \
            -d '{
              "model": "grok-4-latest",
              "input": [
                {
                  "role": "user",
                  "content": "Analise api/index.php e melhore para performance, SEO, acessibilidade, segurança (CSRF, headers), privacidade. Retorne APENAS o código PHP/HTML/JS completo corrigido, sem texto extra."
                }
              ],
              "temperature": 0.3,
              "max_tokens": 8000
            }')
          
          # Novo parse: output array com content blocks
          CONTENT=$(echo "$RESPONSE" | jq -r '.output[0 0 0].text // empty')
          
          echo "Resposta completa da API:"
          echo "$RESPONSE" | head -n 50
          
          if ; then
            echo "ERRO: Resposta vazia ou formato inesperado. Log completo acima."
            exit 0
          fi
          
          echo "$CONTENT" > novo_api_index.php
          mv novo_api_index.php api/index.php || echo "Falha ao mover arquivo"
          echo "Arquivo atualizado!"